language: cpp
arch:
- amd64
- arm64
os:
- linux
- osx
compiler:
- gcc
jobs:
  fast_finish: true
  include:
  - os: linux
    arch: amd64
  - os: linux
    arch: arm64
  - os: osx
addons:
  apt:
    packages:
    - libgtk-3-dev
    - nasm
before_script:
- mkdir build
- cd build
- cmake ..
script: make
before_deploy:
- mkdir deploy
- if [ $TRAVIS_OS_NAME = osx ]; then cp libopenpnp-capture.dylib deploy; cp mac/tests/openpnp-capture-test
  deploy/openpnp-capture-test-mac; fi
- if [ $TRAVIS_OS_NAME = linux ]; then cp libopenpnp-capture.so deploy; cp linux/tests/openpnp-capture-test
  deploy/openpnp-capture-test-linux; fi
- if [ $TRAVIS_CPU_ARCH = arm64 ]; then cp libopenpnp-capture.so deploy/libopenpnp-capture-arm64.so;
  cp linux/tests/openpnp-capture-test deploy/openpnp-capture-test-linux-arm64; fi
deploy:
  provider: releases
  api_key:
    secure: PZJeZ1hhpEHmTYk46ElyjubsZz4fzUDkm1Yc6Cdcyx+VwDl1AmXQl55uC2AufOCVM73WvLuWirkNMHrvJ1eaMxzSZcG17rY8dBKzhLxALPD4aQKdr2xDo7FwYNh3IVy66R2KvfAlaPlcpLc4c1sJscHWkW+/gH61CUKY0bVPsgFUqGUDi1VYea/xMFGJ5MA97Et/R/0aF6Jtgs1RrUhMDJYQ5779hLV9dGmKS8BuM70sZ98rQxG/Qo3L3n5UjIDhGhrVelF/LC+hZzIcEd/Z8zkmOvDe/GIXijpNMPCPzirvpK8B4s7HMqb0QK3N6Uq1HJvn8bzKs1W7x512Co+PErn3JCBJPgvAZJO+2kEg464R5gIq/bvSjTr0VDAJyI730DvXo84IzOjDUtSvbkmqkRuQS6sYuROR0YjeEaJakx8mYcyxnLgFrOKigSdNqK6wexnsaapo6PYXjasM6DqI4AgQZ8lnavcea3AldTHLYyc6DSdcSLdAlOMVqQRAhx+POMUoYTC1zdOroQhWhugEilJRodcsx0RnNkIAHvr/cRrchT0HGxgQcqe5cBwHRpeOmMPs/aBBnHOxjNAqWa/DAhzVNW9AwQOVyXsIfk+wJRk11UvV+ccElSIUyTmqx7idjy9ugfuWMnL7kjcrbGoVl/oBOGbhAmdsb4QwmTqkGbg=
  file_glob: true
  file: deploy/*
  cleanup: false
  edge: true
  on:
    all_branches: true
    tags: true
